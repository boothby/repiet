#! /usr/bin/env python3
import argparse
import sys
import piet2

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Process some integers.')
    parser.add_argument('source', type=str, help = 'source image')
    parser.add_argument('target', type=str, help = 'output filename')
    parser.add_argument('--backend', type=str, 
        choices=['c++', 'python'],
        default='python', help = 'language to compile to')
    parser.add_argument('--optimize', action='store_true', 
        default=False, help = '')
    parser.add_argument('--execute', action='store_true', 
        default=False, help = '')

    args = parser.parse_args()

    if args.backend == 'c++':
        from piet2.backends import cppbackend as backend
    elif args.backend == 'python':
        from piet2.backends import pybackend as backend
    backend=backend()

    if args.optimize:
        from piet2.optimizer import Optimizer as builder
    else:
        from piet2.compiler import Compiler as builder

    c = builder(args.source, backend)
    prog = c.compile(args.target)

    if args.execute:
        backend.execute(args.target)
